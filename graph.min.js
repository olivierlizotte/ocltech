function CreateGraph(e,t,n){fcOnClick=n;divName=t;if(node)node.exit().remove();if(link)link.exit().remove();if(force)force.stop();currentWidth=$("#"+divName).width();currentHeight=$("#"+divName).height();force=d3.layout.force().on("tick",tick).gravity(.06).charge(fcCharge).linkDistance(fcDistance).size([currentWidth,currentHeight]);vis=d3.select("#"+divName).append("svg:svg").attr("width",currentWidth).attr("height",currentHeight).attr("pointer-events","all");d3.timer(fcAnimation);jsonObj=e;updateGraph();window.onresize=ResizeNavPanel}function fcAnimation(){AllNodes.attr("stroke-width",fcStrokeWidth).attr("stroke",fcStroke);AllLinks.attr("stroke-width",fcChangeLinkWidth)}function fcSize(e){if(e.pixelSize)return e.pixelSize;else{var t=Math.sqrt(e.size);if(!e||t<=36)t=36;if(t>160)t=160;e.pixelSize=t;return t}}function fcSizeMain(e){if(e.IsRoot)return fcSize(e)-10;else return fcSize(e)}function fcSizeInside(e){if(e.IsRoot)return fcSize(e);else return 0}function fcOpacityMain(e){if(e.IsRoot)return 0;else return.2}function fcOpacityInside(e){if(e.IsRoot)return.52;else return 0}function fcCharge(e){if(e.charge)return e.charge;else{var t=-fcSize(e)*50;e.charge=t;return t}}function fcDistance(e){if(e.distance)return e.distance;else{if(!e.source||!e.target)return 100;var t=(fcSize(e.source)+fcSize(e.target))*1.5;if(t<40)t=40;e.distance=t;return t}}function fcStrokeWidth(e){if(e.focus){cptStroke+=incrStroke;if(cptStroke>4||cptStroke<1)incrStroke=-incrStroke;return cptStroke}else return 2.5}function fcChangeLinkWidth(e){if(e.source.focus)return cptStroke;else return 2.5}function fcStroke(e){return"#000"}function fcText(e){return e.name}function fcDetail(e){return e.detail}function computeAngle(e){return Math.atan2(e.target.y-e.source.y,e.target.x-e.source.x)*180/Math.PI}function computeLength(e){return Math.sqrt((e.target.x-e.source.x)*(e.target.x-e.source.x)+(e.target.y-e.source.y)*(e.target.y-e.source.y))}function updateGraph(){if(theFocus)theFocus.focus=false;nodes=jsonObj.nodes;links=jsonObj.links;root=nodes[0];root.focus=true;theFocus=root;root.x=currentWidth/2;root.y=currentHeight/2;force.nodes(nodes).links(links).start();link=vis.selectAll("g.link").data(links);svgLink=link.enter().insert("svg:g",".node").attr("class","link");svgLink.append("svg:line").attr("y1","8").attr("y2","8");svgLink.append("svg:line").attr("y1","-8").attr("y2","-8");svgLink.append("svg:text").attr("y","4").text(function(e){return e.name});link.exit().remove();node=vis.selectAll("g.node").data(nodes);var e=node.enter().append("svg:g").attr("class","node").on("mouseup",leftClick).on("mousedown",mouseDown).on("touchstart",mouseDown).on("contextmenu",rightClick).call(force.drag);vis.selectAll("circle").transition().delay(100);e.append("svg:circle").attr("r",fcSizeInside).style("fill-opacity",fcOpacityInside).style("fill",fcColor);e.append("svg:circle").attr("r",fcSizeMain).style("fill-opacity",fcOpacityMain).style("fill",fcColor);e.append("svg:text").attr("x",function(e){return-(e.name.length*4)+.5}).attr("y","0.5").attr("font-size","14px").attr("opacity","1").text(fcText);e.append("svg:text").attr("x",function(e){return-(e.detail.length*2)+.5}).attr("y","16.5").attr("font-size","11px").attr("opacity","1").text(fcDetail);node.exit().remove();AllNodes=node.selectAll("circle");AllLinks=link.selectAll("text")}function tick(){node.attr("transform",function(e){e.x=Math.max(e.pixelSize,Math.min(currentWidth-e.pixelSize,e.x));e.y=Math.max(e.pixelSize,Math.min(currentHeight-e.pixelSize,e.y));return"translate("+e.x+","+e.y+")"});link.attr("transform",function(e){return"translate("+e.source.x+","+e.source.y+") "+"rotate("+computeAngle(e)+",0,0) "+"translate("+fcSize(e.source)+",0)"});link.selectAll("line").attr("x2",function(e){return computeLength(e)-fcSize(e.target)-fcSize(e.source)});link.selectAll("text").attr("x",function(e){return(computeLength(e)-fcSize(e.target)-fcSize(e.source))*.5-e.target.name.length*.5})}function fcColor(e){if(e.IsRoot)return"#ffffff";if(e.size>1)return"#70a0cf";if(e._children)return"#3182bd";return"#c6dbef"}function rightClick(e){d3.event.preventDefault()}function leftClick(e){d3.event.preventDefault()}function mouseDown(e){for(i=0;i<nodes.length;i++)nodes[i].fixed=false;e.fixed=true;if(theFocus)theFocus.focus=false;e.focus=true;theFocus=e;d3.event.preventDefault();fcOnClick(e)}function ResizeNavPanel(){if(currentWidth!=$("#"+divName).width()||currentHeight!=$("#"+divName).height()){if(root){currentWidth=$("#"+divName).width();currentHeight=$("#"+divName).height();force.size([currentWidth,currentHeight]);vis.attr("width",currentWidth).attr("height",currentHeight);updateGraph()}}}var node,link,root,jsonObj,divName,force,currentWidth,currentHeight,vis,nodes,links,svgLink,fcOnClick;var theFocus;var cptStroke=2.5;var incrStroke=.06;var AllNodes;var AllLinks
